<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fight For a New World</title>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.messagestore.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.fallbacks.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.language.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.parser.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.emitter.js"></script>
    <script src="js/lib/jquery.i18n/jquery.i18n.emitter.bidi.js"></script>
    <script src="antixss.js" type="text/javascript"></script>


</head>

<body>
  <header style="box-shadow: 0 4px 2px -2px darkgray; top: 0; bottom: 0; height: 70px; position: absolute; padding: 0; margin: 0; width: 100%;">
    <h1>Fight For A New World</h1>
  </header>

    <div class="content">
      <div class="align-left">
        <h2>Resources</h2>
        <ul class="pad-left">
            <li><a id="Oxygen">Oxygen: <a id="oxy"></a></a></li>
            <li><a id="Hydrogen">Hydrogen: <a id="hyd"></a></a></li>
            <li><a id="Iron">Iron: <a id="irn"></a></a></li>
            <li><a id="Food">Food: <a id="fud"></a></a></li>
            <li><a id="Wood">Wood: <a id="wud"></a></a></li>
            <li><a id="Crystal">Energy Crystal: <a id="crys"></a></a></li>
        </ul></br>
      </div>
      <div class="align-left">
        <h2>Buildings</h2>
        <ul id="buildings" class="pad-left align-left">
        </ul>
      </div>
    </div>
    <footer class="footer">
        <div class="container">
            <span><a style="color: black;">&COPY; Cornelius Frylinck</a></span>
        </div>
    </footer>

</body>
<script>

  var oxy;
  var hyd;
  var irn;
  var fud;
  var wud;
  var crys;

  var oxy_speed;
  var hyd_speed;
  var irn_speed;
  var fud_speed;
  var wud_speed;
  var crys_speed;

    var all_buildings = [
        "Command Centre",
        "Guild Hall",
        "Resource Buildings",
        "Barracks",
        "Radar",
        "Market",
        "Storage",
        "Infirmary",
        "Tech Centre", // shield, towers, walls, traps
        "Research Lab",
        "Resource Bunker",
        "Settlements"
    ]

    var building_list = [
    ]

    var building_link_list = {
        "Command Centre": "commCentre.html",
        "Guild Hall": "guild.html",
        "Resource Buildings": "resbuilds.html",
        "Barracks": "barracks.html",
        "Radar": "radar.html",
        "Market": "market.html",
        "Storage": "storage.html",
        "Infirmary": "infirmary.html",
        "Tech Centre": "tech.html",
        "Research Lab": "lab.html",
        "Resource Bunker": "bunker.html",
        "Settlements": "settlements.html"
    }

    var building_index_list = {
        "Command Centre": "0",
        "Guild Hall": "1",
        "Resource Buildings": "2",
        "Barracks": "3",
        "Radar": "4",
        "Market": "5",
        "Storage": "6",
        "Infirmary": "7",
        "Tech Centre": "8",
        "Research Lab": "9",
        "Resource Bunker": "10",
        "Settlements": "11"
    }

    var building_color_list = {
        "Command Centre": "blue",
        "Guild Hall": "gold",
        "Resource Buildings": "lime",
        "Barracks": "darkred",
        "Radar": "cyan",
        "Market": "orangered",
        "Storage": "silver",
        "Infirmary": "red",
        "Tech Centre": "orange",
        "Research Lab": "green",
        "Resource Bunker": "darkblue",
        "Settlements": "yellow"
    }

    $(document).ready(function(){
      $.ajaxSetup({
        headers: {
          'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
      });

      $.get("./api/start_buildings")
        .done(function(data) {
            if(data.length > 0) {
              building_list = data;
              setBuildings();
            }
        });


        $.get("./api/start_res_details")
          .done(function(data) {
            console.log(data);
            setRes(data);
          });


    });

    setRes = (data) => {
      oxy = data["oxy"];
      hyd = data["hyd"];
      irn = data["irn"];
      fud = data["fud"];
      wud = data["wud"];
      crys = data["crys"];

      setResources();

      oxy_speed = data["oxy_speed"];
      hyd_speed = data["hyd_speed"];
      irn_speed = data["irn_speed"];
      fud_speed = data["fud_speed"];
      wud_speed = data["wud_speed"];
      crys_speed = data["crys_speed"];
    }

    function ready() {
    }

    setBuildings = () => {
        let to_add = "";

        for (let i in building_list) {
            to_add = to_add + `<li><a style="color: ${building_color_list[building_list[i]]}" href="./${building_link_list[building_list[i]]}">${building_list[i]}</a></br></li>`;
            //console.log(to_add);
        }

        let builds = document.getElementById("buildings");
        builds.innerHTML = to_add;
    }

    setResources = () => {
        document.getElementById("oxy").innerText = Math.floor(oxy);
        document.getElementById("hyd").innerText = Math.floor(hyd);
        document.getElementById("irn").innerText = Math.floor(irn);
        document.getElementById("fud").innerText = Math.floor(fud);
        document.getElementById("wud").innerText = Math.floor(wud);
        document.getElementById("crys").innerText = Math.floor(crys);

        document.getElementById("Oxygen").style.color = "aqua";
        document.getElementById("Hydrogen").style.color = "blue";
        document.getElementById("Iron").style.color = "orangered";
        document.getElementById("Food").style.color = "red";
        document.getElementById("Wood").style.color = "brown";
        document.getElementById("Crystal").style.color = "green";

    }

    document.addEventListener("load", ready);

    setInterval(() => {
      $.get("./api/cur_resources_list")
        .done(function(data) {
          console.log(data);
          setRes(data);
        });

        setResources();
    }, 200)

</script>


</html>


<script>

    	//Submit data when enter key is pressed
        $('#user_name').keydown(function(e) {
        	var name = $('#user_name').val();
            if (e.which == 13 && name.length > 0) { //catch Enter key
            	//POST request to API to create a new visitor entry in the database
                $.ajax({
				  method: "POST",
				  url: "./api/visitors",
				  contentType: "application/json",
				  data: JSON.stringify({name: name })
				})
                .done(function(data) {
                    if(data && data.name){
                        if(data._id)
                            $('#response').html($.i18n('added_to_database', AntiXSS.sanitizeInput(data.name)));
                        else
                            $('#response').html($.i18n('hello', AntiXSS.sanitizeInput(data.name)));
                    }
                    else {
                        $('#response').html(AntiXSS.sanitizeInput(data));
                    }
                    $('#nameInput').hide();
                    getNames();
                });
            }
        });

        //Retrieve all the visitors from the database
        function getNames(){
          $.get("./api/visitors")
              .done(function(data) {
                  if(data.length > 0) {
                    data.forEach(function(element, index) {
                      data[index] = AntiXSS.sanitizeInput(element)
                    });
                    $('#databaseNames').html($.i18n('database_contents') + JSON.stringify(data));
                  }
              });
          }

          //Call getNames on page load.
          getNames();


    </script>
